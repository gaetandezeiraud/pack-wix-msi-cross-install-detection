<?xml version="1.0" encoding="utf-8"?>
<CPackWiXPatch>
	<CPackWiXFragment Id="#PRODUCTFEATURE">
		<!-- App always installs; FolderA/B controlled by conditions -->
		<Feature Id="App" Level="1" />
		<Feature Id="FolderA" Level="1000">
			<Condition Level="1">FOLDERA_EXISTS OR DEFAULT_FOLDERA="1"</Condition>
		</Feature>
		<Feature Id="FolderB" Level="1000">
			<Condition Level="1">FOLDERB_EXISTS OR DEFAULT_FOLDERB="1"</Condition>
		</Feature>
	</CPackWiXFragment>
	<CPackWiXFragment Id="#PRODUCT">
		<!-- Define default behavior: FolderA=no, FolderB=yes -->
		<Property Id="DEFAULT_FOLDERA" Value="0" />
		<Property Id="DEFAULT_FOLDERB" Value="1" />
		<!-- Detect folders via marker.txt -->
		<Property Id="FOLDERA_EXISTS">
			<DirectorySearch Id="CheckFolderA" Path="[INSTALLDIR]Data\FolderA">
				<FileSearch Id="CheckFolderAFile" Name="marker.txt" />
			</DirectorySearch>
		</Property>
		<Property Id="FOLDERB_EXISTS">
			<DirectorySearch Id="CheckFolderB" Path="[INSTALLDIR]Data\FolderB">
				<FileSearch Id="CheckFolderBFile" Name="marker.txt" />
			</DirectorySearch>
		</Property>
		<!-- Upgrade: Detect lower-version related products -->
		<Upgrade Id="$(var.CPACK_WIX_UPGRADE_GUID)">
			<UpgradeVersion Minimum="$(var.CPACK_PACKAGE_VERSION)" IncludeMinimum="no" OnlyDetect="no" Property="PREVIOUSVERSIONSINSTALLED" />
		</Upgrade>
	</CPackWiXFragment>
</CPackWiXPatch>